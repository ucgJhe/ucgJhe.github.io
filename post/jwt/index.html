<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Jhe&#39;s blog - JWT </title>
    
    
    <meta content="Web, JWT, security" name="keywords">
    
    <meta content="Jhe&#39;s blog - JOSE(JSON Object Signing and Encryption) 定義了一系列的 RFC 標準
目前有：
 JSON Web Signature JSON Web Encryption JSON Web Key JSON Web Algorithm JSON Web Token  JWT (JSON Web Token) 算是集前面大成者(?)
詳細的介紹可以看這裡，這邊直接從 JWT 切入
每個 JWT 稱為一個 claim，每個 claim 組成為分別為 header.payload.signature (注意它使用 &lsquo;.&rsquo; 來虛隔三者)
Header
{ &#34;typ&#34;: &#34;JWT&#34;, &#34;alg&#34;: &#34;HS256&#34; } typ 代表使用 JWT
alg 代表signature 演算法使用 HS256
Payload
{ &#34;iss&#34;: &#34;&#34;, &#34;sub&#34;: &#34;&#34;, &#34;aud&#34;: &#34;&#34;, &#34;exp&#34;: &#34;&#34;, &#34;nbf&#34;: &#34;&#34;, &#34;iat&#34;: &#34;&#34;, &#34;jti&#34;: &#34;&#34; } payload 中的 data 有明確的欄位定義" name="description">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    

    

    

    

    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/self/css/default.css">
    <script src="/layui/layui.js"></script>

    <link rel="stylesheet" async href="/self/css/markdown.min.css">
    <link rel="stylesheet" async href="/self/css/gallery.css">
    
    
    

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
    <script async src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js" integrity="sha256-h2tMEmhemR2IN4wbbdNjj9LaDIjzwk2hralQwfJmBOE=" crossorigin="anonymous"></script></head>

<body>
    
    <header class="layui-header layui-bg-cyan">

    
    
    <a class="nav-self-logo" href="/">
        Jhe&#39;s blog
    </a>

    <ul class="layui-nav layui-layout-right layui-bg-cyan" lay-filter="">
        
        
        <li class="layui-nav-item" id="nav_big"><a href="/post/">Posts</a></li>
        

        

        
        <li class="layui-nav-item" id="nav_small">
            <a href="javascript:;">
                <i class="layui-icon layui-icon-app" style="font-size: 24px;"></i>
            </a>

            <dl class="layui-nav-child">
                
                <dd><a href="/post/">Posts</a></dd>
                

                
            </dl>
        </li>
    </ul>
</header>

<script>
layui.use('element', function(){
  var element = layui.element;
});
</script>
        <div id="content" style="min-height:80%">
<div class="layui-container" style="margin-bottom: 10px">
    

    <div class="layui-row layui-col-space10">
        <div class="layui-col-md8 layui-col-sm12 layui-col-xs12">
            <div class="layui-card single-card">
                <br />
                <blockquote class="self-elem-quote  markdown-body single-title" >
                    <h1>JWT</h1>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>2017-04-03</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/security/">
            <span class="layui-badge " style="vertical-align: 2px;">security</span>
        </a>
    

    
    <i class="layui-icon layui-icon-tabs" style="font-size: 22px; vertical-align: 1px;margin-right:2px;"></i>
    

    
        <a href="/tags/web/">
            <span class="layui-badge " style="vertical-align: 2px;">Web</span>
        </a>
    
        <a href="/tags/jwt/">
            <span class="layui-badge " style="vertical-align: 2px;">JWT</span>
        </a>
    
    
</h3>
                </blockquote>
                <div class="layui-card-body markdown-body single-content">
                    <p>JOSE(JSON Object Signing and Encryption) 定義了一系列的 RFC 標準</p>
<p>目前有：</p>
<ul>
<li>JSON Web Signature</li>
<li>JSON Web Encryption</li>
<li>JSON Web Key</li>
<li>JSON Web Algorithm</li>
<li>JSON Web Token</li>
</ul>
<p>JWT (JSON Web Token) 算是集前面大成者(?)</p>
<p>詳細的介紹可以看<a href="https://blog.othree.net/log/2016/08/13/json-web-token/">這裡</a>，這邊直接從 JWT 切入</p>
<p>每個 JWT 稱為一個 claim，每個 claim 組成為分別為 header.payload.signature (注意它使用 &lsquo;.&rsquo; 來虛隔三者)</p>
<p><strong>Header</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;typ&#34;</span>: <span style="color:#e6db74">&#34;JWT&#34;</span>,  
    <span style="color:#f92672">&#34;alg&#34;</span>: <span style="color:#e6db74">&#34;HS256&#34;</span>
}
</code></pre></div><p>typ 代表使用 JWT</p>
<p>alg 代表signature 演算法使用 HS256</p>
<p><strong>Payload</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;iss&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;sub&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, 
    <span style="color:#f92672">&#34;aud&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, 
    <span style="color:#f92672">&#34;exp&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, 
    <span style="color:#f92672">&#34;nbf&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, 
    <span style="color:#f92672">&#34;iat&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, 
    <span style="color:#f92672">&#34;jti&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>  
}
</code></pre></div><p>payload 中的 data 有明確的欄位定義</p>
<p>因為沒有很重要所以就不做說明</p>
<p><strong>Signature</strong></p>
<p>因 header 裡 alg 所標示的演算法而有所差異</p>
<p><strong>Example</strong></p>
<p>以上每個部份都要使用 bas64 encode (將截尾用於 padding 的 = 移除)，之後使用點(dot)來做連接</p>
<p>這裡是 <a href="https://jwt.io/">JWT.io</a> 給出的範例</p>
<pre tabindex="0"><code class="language-json=" data-lang="json=">header = {&quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;}
pylaod = {&quot;sub&quot;: &quot;1234567890&quot;, &quot;name&quot;: &quot;John Doe&quot;, &quot;admin&quot;, true}
signature = HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), SECRET)
</code></pre><p>上述資料處理後長相如下</p>
<p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</code></p>
<p><strong>Problem</strong></p>
<ol>
<li>none algorithm</li>
</ol>
<p>這裡有個有趣的地方，header 部份的 alg 是可選的，之後應該由 server 端以 alg 所標明的方式驗證</p>
<p>但若 alg = none, 意思為不使用任何演算法處理，但格式只要正確此 JWT 仍屬有效(validate)</p>
<p>此處 RFC 7519 已有標明屬於 unsecrure JWT，但實做時可能會沒注意導致 header 被竄改以後 token 可被偽造</p>
<p>以下為 validate 的 JWT</p>
<p><code>eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.</code></p>
<ol start="2">
<li>RSA or HMAC</li>
</ol>
<p>alg 除了 HS256 還有 RS256 等其他的選項可選，假設現在我的 server 給 client 是標明使用 RS256 的驗證方式</p>
<p>當 alg 為 RS256 時，token 使用 private key 來簽發，但是 server 驗證的時候使用 public key 來驗證</p>
<p>如果將 public key 釋出自己保留 private key 的話，則只有你可以簽發 token，其他人則可以利用 public key 來驗證</p>
<p>這個 token 是否由你所簽發的，在實做的時候可能看起來像這樣</p>
<p><code>verify(token,verification_key)</code></p>
<p>當 server 使用 HMAC signature 時 verification_key ，function 可能會長這樣</p>
<p><code>verify(client_token, server_HMACSecretKey)</code></p>
<p>當 server 使用非對稱式演算法時，verification_key 會成為 public key，function 驗證可能長這樣</p>
<p><code>verify(client_token, serverRSAPublicKey)</code></p>
<p>因此若 header alg 從 RS256 被竄改成 HS256 則 server 會將 public key 認為是一個 HMAC secret key</p>
<p>問題來了 public key 是大家都可以知道的，所以 token 在這種情況下可以被 server 正確的驗證</p>
<p>因此 token 就可以任意偽造，視 token 的用途所造成的傷害不一。</p>
<p>可以在 <a href="https://jwt.io">JWT.io</a> 了解各個語言函式庫的支援程度及安全的版本。</p>
<p><a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/">Reference</a></p>
</div>
            </div>
        </div>

        <div class="layui-col-md4 layui-col-sm12 layui-col-xs12">
            

            <div class="layui-card single-card">
                <h2 class="single-title">Recent Posts</h2>
            
                
                <div style="margin-left: 10px;">
                    <blockquote class="self-elem-quote " style="background-color:#FFFFFF;margin-top: 10px;">
                    <a href="/post/cve_2020_8962/">
                        <h3 class="">How to reproduce CVE-2020-8962 with Qiling Framework</h3>
                    </a>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>2020-07-30</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/security/">
            <span class="layui-badge " style="vertical-align: 2px;">security</span>
        </a>
    

    
    <i class="layui-icon layui-icon-tabs" style="font-size: 22px; vertical-align: 1px;margin-right:2px;"></i>
    

    
        <a href="/tags/qiling/">
            <span class="layui-badge " style="vertical-align: 2px;">Qiling</span>
        </a>
    
        <a href="/tags/cve/">
            <span class="layui-badge " style="vertical-align: 2px;">CVE</span>
        </a>
    
        <a href="/tags/d-link/">
            <span class="layui-badge " style="vertical-align: 2px;">D-Link</span>
        </a>
    
    
</h3>
                    </blockquote>
                </div>
                
                <div style="margin-left: 10px;">
                    <blockquote class="self-elem-quote " style="background-color:#FFFFFF;margin-top: 10px;">
                    <a href="/post/elf_symbol_resolving/">
                        <h3 class="">ELF Symbol Resolving</h3>
                    </a>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>2019-12-12</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/security/">
            <span class="layui-badge " style="vertical-align: 2px;">security</span>
        </a>
    

    
    <i class="layui-icon layui-icon-tabs" style="font-size: 22px; vertical-align: 1px;margin-right:2px;"></i>
    

    
        <a href="/tags/elf/">
            <span class="layui-badge " style="vertical-align: 2px;">ELF</span>
        </a>
    
    
</h3>
                    </blockquote>
                </div>
                
                <div style="margin-left: 10px;">
                    <blockquote class="self-elem-quote " style="background-color:#FFFFFF;margin-top: 10px;">
                    <a href="/post/python_pickle/">
                        <h3 class="">Python Pickle</h3>
                    </a>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>2019-05-30</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/security/">
            <span class="layui-badge " style="vertical-align: 2px;">security</span>
        </a>
    

    
    <i class="layui-icon layui-icon-tabs" style="font-size: 22px; vertical-align: 1px;margin-right:2px;"></i>
    

    
        <a href="/tags/python/">
            <span class="layui-badge " style="vertical-align: 2px;">Python</span>
        </a>
    
        <a href="/tags/pickle/">
            <span class="layui-badge " style="vertical-align: 2px;">Pickle</span>
        </a>
    
    
</h3>
                    </blockquote>
                </div>
                
                <div style="margin-left: 10px;">
                    <blockquote class="self-elem-quote " style="background-color:#FFFFFF;margin-top: 10px;">
                    <a href="/post/lazy_binding_in_elf/">
                        <h3 class="">Lazy binding in ELF</h3>
                    </a>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>2019-05-15</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/security/">
            <span class="layui-badge " style="vertical-align: 2px;">security</span>
        </a>
    

    
    <i class="layui-icon layui-icon-tabs" style="font-size: 22px; vertical-align: 1px;margin-right:2px;"></i>
    

    
        <a href="/tags/elf/">
            <span class="layui-badge " style="vertical-align: 2px;">ELF</span>
        </a>
    
    
</h3>
                    </blockquote>
                </div>
                
                <div style="margin-left: 10px;">
                    <blockquote class="self-elem-quote " style="background-color:#FFFFFF;margin-top: 10px;">
                    <a href="/post/css_exfiltration/">
                        <h3 class="">CSS Exfiltration</h3>
                    </a>
                    <h3 style="margin-top:10px; margin-bottom:10px"> 
    <i class="layui-icon layui-icon-date" style="font-size: 28px; vertical-align: -2px;"></i>
    <span>2019-04-30</span>

    
     
    <i class="layui-icon layui-icon-list" style="font-size: 32px; vertical-align: -3px;"></i>
    

    
        <a href="/categories/security/">
            <span class="layui-badge " style="vertical-align: 2px;">security</span>
        </a>
    

    
    <i class="layui-icon layui-icon-tabs" style="font-size: 22px; vertical-align: 1px;margin-right:2px;"></i>
    

    
        <a href="/tags/chrome/">
            <span class="layui-badge " style="vertical-align: 2px;">Chrome</span>
        </a>
    
        <a href="/tags/css/">
            <span class="layui-badge " style="vertical-align: 2px;">CSS</span>
        </a>
    
    
</h3>
                    </blockquote>
                </div>
                
            
            <br />
            </div>
        </div>

    </div>
</div>


        </div><footer>
    
    
    <div class="layui-container">
        <p class="copyright">&copy; All rights reserved. Powered by <a href='https://gohugo.io' style='color:#FFFFFF'>Hugo</a> and <a href='https://github.com/ertuil/erblog' style='color:#FFFFFF'>Erblog</a>.</p>
    </div>
</footer>
</body>
</html>
